From 3aac3ab7026be21032c861f22f5d1044501cad25 Mon Sep 17 00:00:00 2001
From: Andreas Beckmann <anbe@debian.org>
Date: Fri, 24 Jan 2025 12:37:59 +0100
Subject: [PATCH] backport uvm fixes from 535.230.02

---
 nvidia-uvm/uvm_kvmalloc.c | 2 +-
 nvidia-uvm/uvm_mmu.h      | 2 +-
 nvidia-uvm/uvm_pmm_gpu.c  | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/nvidia-uvm/uvm_kvmalloc.c b/nvidia-uvm/uvm_kvmalloc.c
index 69e0b30b..2285a479 100644
--- a/nvidia-uvm/uvm_kvmalloc.c
+++ b/nvidia-uvm/uvm_kvmalloc.c
@@ -36,7 +36,7 @@
 typedef struct
 {
     size_t alloc_size;
-    uint8_t ptr[0];
+    uint8_t ptr[];
 } uvm_vmalloc_hdr_t;
 
 typedef struct
diff --git a/nvidia-uvm/uvm_mmu.h b/nvidia-uvm/uvm_mmu.h
index ef74814c..afd45f2d 100644
--- a/nvidia-uvm/uvm_mmu.h
+++ b/nvidia-uvm/uvm_mmu.h
@@ -167,7 +167,7 @@ struct uvm_page_directory_struct
     // pointers to child directories on the host.
     // this array is variable length, so it needs to be last to allow it to
     // take up extra space
-    uvm_page_directory_t *entries[0];
+    uvm_page_directory_t *entries[];
 };
 
 enum
diff --git a/nvidia-uvm/uvm_pmm_gpu.c b/nvidia-uvm/uvm_pmm_gpu.c
index 003bde59..41eec921 100644
--- a/nvidia-uvm/uvm_pmm_gpu.c
+++ b/nvidia-uvm/uvm_pmm_gpu.c
@@ -220,7 +220,7 @@ struct uvm_pmm_gpu_chunk_suballoc_struct
     // Array of all child subchunks
     // TODO: Bug 1765461: Can the array be inlined? It could save the parent
     //       pointer.
-    uvm_gpu_chunk_t *subchunks[0];
+    uvm_gpu_chunk_t *subchunks[];
 };
 
 typedef enum
-- 
2.39.5

